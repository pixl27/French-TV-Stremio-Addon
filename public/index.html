<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French TV - Stremio Addon</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì∫</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>
<body>
    <div class="container">
        <header class="animate__animated animate__fadeInDown">
            <div class="logo-container">
                <div class="logo"></div>
                <h1>French TV</h1>
            </div>
            <p class="tagline">Watch Live French Television Channels on Stremio</p>
        </header>
        
        <div class="hero animate__animated animate__fadeIn animate__delay-1s">
            <div class="hero-content">
                <h2>Stream French TV channels directly in Stremio</h2>
                <p>Access your favorite French television channels in one place with this Stremio addon.</p>
                
                <div class="buttons">
                    <a href="#" id="install-button" class="button primary">Install Addon</a>
                    <a href="/manifest.json" class="button secondary">View Manifest</a>
                </div>
            </div>
            <div class="preview">
                <div class="preview-image"></div>
                <div class="donation-message">
                    <div class="donation-icon">‚ù§Ô∏è</div>
                    <p>If you enjoy this addon, please consider <a href="https://ko-fi.com/maheryrakotondrazaka" class="donation-link">making a donation</a> to support its development!</p>
                </div>
            </div>
        </div>

        <section class="channel-preview animate__animated animate__fadeIn animate__delay-1s">
            <div class="section-header">
                <h2>Available Channels</h2>
                <div class="header-actions">
                    <div class="channel-count" id="channel-count">Loading channels...</div>
                    <button id="see-all-btn" class="button secondary see-more-btn">See All</button>
                </div>
            </div>
            
            <div class="channel-scroller">
                <div class="channel-grid horizontal" id="channel-grid">
                    <!-- Channel previews will be added here dynamically -->
                    <div class="channel-card skeleton"></div>
                    <div class="channel-card skeleton"></div>
                    <div class="channel-card skeleton"></div>
                    <div class="channel-card skeleton"></div>
                    <div class="channel-card skeleton"></div>
                    <div class="channel-card skeleton"></div>
                </div>
                <div class="scroll-indicator">
                    <div class="scroll-arrow">‚Üí</div>
                </div>
            </div>
        </section>

        <!-- Channel modal for all channels -->
        <div id="channel-modal" class="channel-modal">
            <div class="channel-modal-content">
                <div class="modal-header">
                    <h3>All French TV Channels</h3>
                    <button id="close-modal" class="close-button">&times;</button>
                </div>
                <div class="channel-search">
                    <input type="text" id="channel-search-input" placeholder="Search for a channel...">
                </div>
                <div class="channel-grid full" id="full-channel-grid">
                    <!-- All channels will be loaded here -->
                    <div class="channel-card skeleton"></div>
                    <div class="channel-card skeleton"></div>
                    <div class="channel-card skeleton"></div>
                    <div class="channel-card skeleton"></div>
                    <div class="channel-card skeleton"></div>
                    <div class="channel-card skeleton"></div>
                </div>
            </div>
        </div>

        <section class="features animate__animated animate__fadeIn animate__delay-2s">
            <h2>Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">üì∫</div>
                    <h3>Live TV Channels</h3>
                    <p>Stream a variety of French television channels directly in your Stremio app.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîç</div>
                    <h3>Easy Browsing</h3>
                    <p>Browse channels by category and find your favorite content quickly.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Fast & Reliable</h3>
                    <p>Enjoy high-quality streams with minimal buffering.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üåê</div>
                    <h3>Watch Anywhere</h3>
                    <p>Compatible with all Stremio platforms - desktop, mobile, and TV.</p>
                </div>
            </div>
        </section>

        <section class="installation animate__animated animate__fadeIn animate__delay-2s">
            <h2>How to Install</h2>
            <ol class="steps">
                <li>
                    <h3>Install Stremio</h3>
                    <p>If you haven't already, download and install <a href="https://www.stremio.com/downloads" target="_blank">Stremio</a> on your preferred device.</p>
                </li>
                <li>
                    <h3>Add French TV Addon</h3>
                    <p>Click the "Install Addon" button above or manually add this URL in Stremio:</p>
                    <div class="code-block">
                        <code id="addon-url"></code>
                        <button class="copy-button" onclick="copyToClipboard()">Copy</button>
                    </div>
                </li>
                <li>
                    <h3>Enjoy Your Channels</h3>
                    <p>Browse through the available channels in the "TV Channels" section of Stremio.</p>
                </li>
            </ol>
        </section>

        <footer class="animate__animated animate__fadeIn animate__delay-3s">
            <p>&copy; <span id="current-year"></span> French TV Stremio Addon</p>
            <p class="disclaimer">This addon is not affiliated with Stremio or any TV channel.</p>
        </footer>
    </div>

    <script>
        // Set the current year
        document.getElementById('current-year').textContent = new Date().getFullYear();
        
        // Set the addon URL and prepare Stremio installation URL
        const manifestUrl = window.location.origin + '/manifest.json';
        document.getElementById('addon-url').textContent = manifestUrl;
        
        // Setup install button with the proper Stremio URL
        const installButton = document.getElementById('install-button');
        installButton.setAttribute('href', 'stremio://' + window.location.host + '/manifest.json');
        
        // Copy URL function
        function copyToClipboard() {
            const url = document.getElementById('addon-url').textContent;
            navigator.clipboard.writeText(url).then(() => {
                const button = document.querySelector('.copy-button');
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }
        
        // Channel data storage
        let allChannels = [];
        
        // Load channel preview
        async function loadChannelPreview() {
            try {
                const response = await fetch('/manifest.json');
                if (!response.ok) throw new Error('Failed to load manifest');
                
                // Get ALL channel data directly from the API
                fetch('/api/channels')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to load channels');
                        }
                        return response.json();
                    })
                    .then(channels => {
                        // Save all channels for later use
                        allChannels = channels;
                        
                        // Update channel count display
                        const channelCount = document.getElementById('channel-count');
                        channelCount.textContent = `${channels.length} channels available`;
                        
                        // Display the first 12 channels in the horizontal scroller
                        displayChannels(channels.slice(0, 12), 'channel-grid', true);
                        
                        // Also prepare all channels for the modal view
                        displayChannels(channels, 'full-channel-grid');
                        
                        // Start horizontal auto-scroll animation
                        startAutoScroll();
                    })
                    .catch(error => {
                        console.error('Error loading channels:', error);
                        displayPlaceholderChannels();
                    });
            } catch (error) {
                console.error('Error loading manifest:', error);
                displayPlaceholderChannels();
            }
        }
        
        function displayChannels(channels, targetId, isHorizontal = false) {
            const channelGrid = document.getElementById(targetId);
            channelGrid.innerHTML = '';
            
            channels.forEach(channel => {
                const channelCard = document.createElement('div');
                channelCard.className = 'channel-card';
                
                const channelLogo = document.createElement('div');
                channelLogo.className = 'channel-logo';
                if (channel.logo) {
                    channelLogo.style.backgroundImage = `url(${channel.logo})`;
                } else {
                    // Fallback for channels without logo
                    channelLogo.classList.add('no-logo');
                    channelLogo.textContent = channel.name.substr(0, 2).toUpperCase();
                }
                
                const channelName = document.createElement('div');
                channelName.className = 'channel-name';
                channelName.textContent = channel.name;
                
                // Clicking a channel opens it in Stremio
                channelCard.addEventListener('click', () => {
                    const stremioUrl = `stremio://stremio/detail/tv/iptv-${channel.id}/`;
                    window.open(stremioUrl, '_blank');
                });
                
                channelCard.appendChild(channelLogo);
                channelCard.appendChild(channelName);
                channelGrid.appendChild(channelCard);
            });
            
            // Add animation to the cards
            setupScrollAnimations();
        }
        
        function displayPlaceholderChannels() {
            const channelGrid = document.getElementById('channel-grid');
            channelGrid.innerHTML = '';
            
            // French flag-colored placeholders
            const placeholders = [
                { name: 'TF1', color: 'var(--french-blue)' },
                { name: 'France 2', color: 'var(--french-white)' },
                { name: 'France 3', color: 'var(--french-red)' },
                { name: 'M6', color: 'var(--french-blue)' },
                { name: 'Arte', color: 'var(--french-white)' },
                { name: 'Canal+', color: 'var(--french-red)' }
            ];
            
            placeholders.forEach(placeholder => {
                const channelCard = document.createElement('div');
                channelCard.className = 'channel-card';
                
                const channelLogo = document.createElement('div');
                channelLogo.className = 'channel-logo no-logo';
                channelLogo.style.backgroundColor = placeholder.color;
                channelLogo.textContent = placeholder.name.substr(0, 2).toUpperCase();
                
                const channelName = document.createElement('div');
                channelName.className = 'channel-name';
                channelName.textContent = placeholder.name;
                
                channelCard.appendChild(channelLogo);
                channelCard.appendChild(channelName);
                channelGrid.appendChild(channelCard);
            });
        }
        
        // Modal functionality for "See All" channels
        const modal = document.getElementById('channel-modal');
        const seeAllBtn = document.getElementById('see-all-btn');
        const closeModalBtn = document.getElementById('close-modal');
        
        seeAllBtn.addEventListener('click', () => {
            modal.classList.add('show');
            document.body.style.overflow = 'hidden'; // Prevent scrolling behind modal
        });
        
        closeModalBtn.addEventListener('click', () => {
            modal.classList.remove('show');
            document.body.style.overflow = ''; // Restore scrolling
        });
        
        // Close modal when clicking outside the content
        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        });
        
        // Channel search functionality in modal
        const searchInput = document.getElementById('channel-search-input');
        
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredChannels = allChannels.filter(channel => 
                channel.name.toLowerCase().includes(searchTerm)
            );
            displayChannels(filteredChannels, 'full-channel-grid');
        });
        
        // Add scroll animations for the featured content
        function setupScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate__fadeInUp');
                        entry.target.style.opacity = 1;
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            
            document.querySelectorAll('.feature-card, .channel-card').forEach(card => {
                if (!card.style.opacity) {
                    card.style.opacity = 0;
                    card.classList.add('animate__animated');
                    observer.observe(card);
                }
            });
        }
        
        // Fixed auto-scroll functionality for horizontal channels
        function startAutoScroll() {
            const channelScroller = document.querySelector('.channel-scroller');
            const scrollIndicator = document.querySelector('.scroll-indicator');
            
            if (!channelScroller) return;
            
            // Initial auto-scroll animation with proper timing
            let autoScrollInterval;
            
            function autoScrollAnimation() {
                // Check if we can scroll right
                const canScrollRight = channelScroller.scrollWidth > channelScroller.clientWidth;
                
                if (!canScrollRight) {
                    scrollIndicator.classList.add('fade');
                    return;
                }
                
                // Scroll right slowly
                let scrollPos = 0;
                const maxScroll = channelScroller.scrollWidth - channelScroller.clientWidth;
                const duration = 15000; // 15 seconds
                const increment = maxScroll / (duration / 16); // For smooth scrolling at 60fps
                
                autoScrollInterval = setInterval(() => {
                    scrollPos += increment;
                    if (scrollPos >= maxScroll) {
                        clearInterval(autoScrollInterval);
                        
                        // After reaching the end, scroll back to start slowly
                        setTimeout(() => {
                            let returnScroll = maxScroll;
                            const returnInterval = setInterval(() => {
                                returnScroll -= increment;
                                channelScroller.scrollLeft = returnScroll;
                                
                                if (returnScroll <= 0) {
                                    clearInterval(returnInterval);
                                    
                                    // After returning to start, restart the whole animation
                                    setTimeout(() => {
                                        autoScrollAnimation();
                                    }, 5000);
                                }
                            }, 16);
                        }, 3000);
                    }
                    channelScroller.scrollLeft = scrollPos;
                }, 16);
            }
            
            // Start the auto-scroll animation after channels are loaded
            setTimeout(() => {
                autoScrollAnimation();
            }, 2000);
            
            // When manually scrolling, stop the automatic animation
            channelScroller.addEventListener('wheel', () => {
                if (autoScrollInterval) {
                    clearInterval(autoScrollInterval);
                }
            });
            
            channelScroller.addEventListener('touchstart', () => {
                if (autoScrollInterval) {
                    clearInterval(autoScrollInterval);
                }
            });
            
            channelScroller.addEventListener('mousedown', () => {
                if (autoScrollInterval) {
                    clearInterval(autoScrollInterval);
                }
            });
            
            // Update scroll indicator visibility on manual scroll
            channelScroller.addEventListener('scroll', () => {
                if (channelScroller.scrollLeft > 0) {
                    scrollIndicator.classList.add('fade');
                } else {
                    scrollIndicator.classList.remove('fade');
                }
            });
        }
        
        // Initialize on document load
        document.addEventListener('DOMContentLoaded', () => {
            loadChannelPreview();
            setupScrollAnimations();
        });
    </script>
</body>
</html>